# RTMfT
Resume Time Modifier for TvRock

### 目的
TvRockにおける[ACPI Wake Alarmによる復帰(レジューム)時間の遅れ](https://ttgcameback.blogspot.com/2024/05/acpi-wake-alarm-asus-prime-b760m-aj-d4.html)をTvRock自身に直接補正してもらいます。

### 概要
実行中のTvRockのスリープ開始時に行う復帰(レジューム)準備処理に対し、DLLインジェクションを行ってメモリ上でパッチを当てることによりTvRock自身で補正済みの復帰時刻を設定するようにさせます。  
これにより、TvRock以外のプロセスを補正のために常時起動しておく必要がなくなります。  

対象のTvRockのバージョンは不問です。  
TvRock.exeファイルは改変しません。  
タスクスケジューラによる復帰には目的外のため対応していません。  

### インストール
`RTMfT.x86.dll`および`RTMfTMgr.x86.exe`を同じディレクトリに配置してください。  
このディレクトリにログファイルを生成します。自動ローテート(1世代)しますので特にメンテナンスは必要ありません。

### コマンドラインオプション
`RTMfTMgr.x86.exe`のオプションは次の通りです。
未指定の場合は *`パッチ自動貼付モード`*  (後述)で起動します。
- **`/attach`**  
  TvRockにパッチを貼付してプログラムを終了します。  
  戻値(ERRORLEVEL)
  - **0**: パッチの貼付に成功しました。
  - **1**: パッチの貼付に失敗しました。
- **`/detach`**  
  TvRockからパッチを除去してプログラムを終了します。  
  戻値(ERRORLEVEL)
  - **0**: パッチを除去に成功しました。
  - **1**: パッチを除去に失敗しました。
- **`/restart`** *`FULL PATH NAME`*  
  *`パッチ自動貼付モード`* に加え、TvRockが起動していない(もともと起動していない、頓死、手動で停止等)場合、5秒毎に *`FULL PATH NAME`*  で指定されたプロセスの起動を試みます。  
  *`FULL PATH NAME`*  を省略した場合、*`パッチ自動貼付モード`* で最初に検出されたTvRock.exeを検出以後の再起動の対象にします。  

### パッチ自動貼付モード
TvRockの頓死対策として、TvRockが再起動した場合にパッチを自動的に貼付するモードで起動します。  
タスクトレイにアイコンが追加されますので、
アイコン上で右クリックを行うことにより本プログラムの操作メニューが表示されます。  
アイコンの色が青の場合はTvRockにパッチが適用されています。赤の場合はTvRockが起動していないか、パッチは未適用です。  
TvRockの再起動をも併せて行う場合は **`/restart`** オプションを指定してください。   
貼付間隔は最少で即時、最大で60秒( **`/restart`** 未指定時)です。

### 補正すべき時間の計算について
スリープ開始時点において3時間半以上未来に復帰する場合に補正します。   
補正時間は[当方にて観察された結果](https://ttgcameback.blogspot.com/2024/05/acpi-wake-alarm-asus-prime-b760m-aj-d4.html)をもとに計算していますので、万人に通用するかどうかはわかりません。

### ライセンス
GPLv3
